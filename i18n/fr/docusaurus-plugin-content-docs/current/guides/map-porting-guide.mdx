---
id: map-porting-guide
title: Guide de Portage des Cartes
---

Ce guide s’adresse à toutes les cartes créées avant la version 1.0.0 et la sortie de l’API de modding, comme le [Australia/New Zealand Pack by expedtadam](https://drive.google.com/drive/folders/18fpT9ASi3kMIK0lYjOzAbb-IM_RPZ6cz). Il nécessite un peu plus de configuration, mais peut tout de même être porté vers le nouveau framework relativement facilement.

### Étape 1 - Installer le Map Manager
Téléchargez la dernière version du Map Manager sur https://github.com/Kronifer/subwaybuilder-patcher/releases. Pour télécharger, cliquez sur la version correspondant à votre système d’exploitation.

<img width="1000" alt="image" src="/images/map-manager-download.png" />

:::note
Sous Windows, téléchargez le fichier `.exe`. Sous Linux, téléchargez le fichier `.zip`. Sous macOS, utilisez le fichier `arm64.dmg` si votre Mac possède une puce Apple Silicon (par exemple M1, M2, M3, etc.) et le fichier `x64.dmg` si votre Mac possède une puce Intel. En règle générale, les Mac sortis après environ 2021 utilisent Apple Silicon, tandis que les modèles plus anciens utilisent Intel — mais vérifiez, car il existe des exceptions.
:::

:::note
Sous macOS, l’installateur `.dmg` sera probablement mis en quarantaine. Pour l’exécuter, ouvrez un terminal dans le dossier où vous l’avez téléchargé, puis exécutez `xattr -d com.apple.quarantine {NOM_DU_FICHIER_INSTALLATEUR}`. Par exemple, si vous téléchargez la version 0.2.7 pour un Mac ARM, exécutez `xattr -d com.apple.quarantine Subway.Builder.Map.Manager-0.2.7-arm64.dmg`.

De plus, le dossier Library contenant le dossier metro-maker4 peut être masqué par défaut. Pour l’afficher, ouvrez Finder, allez dans votre dossier personnel (Home), puis sélectionnez Présentation → Afficher les options de présentation → Afficher le dossier Bibliothèque.
:::

Ensuite, installez l’application comme n’importe quelle autre. Une fois l’installation terminée, lancez l’application et suivez le processus de configuration en sélectionnant l’emplacement de l’exécutable du jeu ainsi que votre dossier `metro-maker4`. À ce stade, vous pouvez supprimer le fichier ZIP, l’installateur et tout autre fichier téléchargé.

<img width="1200" alt="image" src="https://private-user-images.githubusercontent.com/19807509/553076498-ea9604c2-bc93-4cb4-939c-73d957b22f2a.png?jwt=..." />

### Étape 2 - Extraire les Fichiers
Nous devons maintenant extraire les fichiers nécessaires à partir de la carte téléchargée. Nous aurons besoin de 6 fichiers au total :
 - `XXX.pmtiles` (`XXX` correspond au code de votre ville ; par exemple `MIA` pour Miami)
 - `demand_data.json`
 - `buildings_index.json`
 - `roads.geojson`
 - `runways_taxiways.geojson`
 - `config.json`

Le premier est simple. Dans le dossier de la carte téléchargée, recherchez le fichier `XXX.pmtiles`. Il se trouve quelque part dans le répertoire, soit à la racine, soit dans un sous-dossier. Créez un dossier temporaire afin d’y stocker nos 6 fichiers.

Les 4 suivants demandent un peu plus de travail. Vous devriez pouvoir les trouver facilement, mais ils sont compressés (ils se terminent par `.gz`). Nous devrons les extraire comme une archive.

:::important
Si vos 4 fichiers sont au format `.gz` (par exemple `demand_data.json.gz`), continuez à lire et suivez le reste de cette étape. S’ils ne sont pas au format `.gz` (par exemple `demand_data.json`), ignorez le reste de cette étape, déplacez-les dans le dossier temporaire et passez à l’Étape 3. Si les 4 fichiers sont totalement absents, alors la carte téléchargée est incomplète. Vous pouvez soit [générer les données vous-même](https://github.com/kaicardenas0618/Subway-Builder-Map-Directory/wiki/Creating-a-Custom-Map), soit trouver une autre carte.
:::

:::tip
Sous Windows et Linux, vous pouvez utiliser [7-Zip](https://www.7-zip.org/download.html) pour extraire les archives `.gz`. macOS prend en charge nativement les archives gzip : il suffit donc de double-cliquer dessus pour les extraire.
:::

À l’intérieur, vous devriez voir un seul fichier. Par exemple, dans `demand_data.json.gz`, vous trouverez `demand_data.json`, et il en va de même pour les 3 autres archives. Extrayez les 4 fichiers et placez-les dans votre dossier temporaire. Certaines cartes contiennent des fichiers de données en double à différents endroits ; peu importe lequel vous choisissez, ils sont identiques.

### Étape 3 - Créer le Fichier Config
Le dernier fichier dont nous avons besoin est `config.json`. C’est le plus complexe. Commencez par créer un nouveau fichier nommé `config.json`.

:::tip
Assurez-vous qu’il s’agit bien d’un fichier `.json`. Si l’extension n’apparaît pas, recherchez comment activer l’affichage des extensions de fichiers sur votre système d’exploitation.
:::

Collez ensuite ce modèle dans `config.json` :
```
{
  "name": "Boise",
  "code": "BOI",
  "description": "Build a rapid transit network for one of America`s fastest growing cities.",
  "population": 329866,
  "initialViewState": {
    "zoom": 13,
    "latitude": 43.617499,
    "longitude": -116.245394,
    "bearing": 0
  },
  "creator": "muffintime",
  "version": "2.1.0"
}
```

Nous devons modifier ces données pour qu’elles correspondent à votre carte. Dans le dossier de la carte, il devrait y avoir un fichier `.js`, généralement nommé `index.js`, `main.js` ou `config.js`, mais il peut avoir un autre nom.

<img width="1097" height="402" alt="image" src="/images/city-data.png" />

> Exemple provenant du fichier `index.js` du Canadian Cities Map Pack.

:::tip
S’il y a plusieurs fichiers `.js`, vérifiez-les tous. L’un d’eux contient les données nécessaires.
:::

Depuis ce fichier, nous pouvons récupérer :
 - `name`
 - `code`
 - `description`
 - `population`
 - `initialViewState` (et tous ses paramètres)

:::note
Si vos données ne contiennent pas `initialViewState`, vous pouvez utiliser 12 ou 13 pour `zoom` et 0 pour `bearing`. Pour `latitude` et `longitude`, choisissez une valeur située dans la plage des coordonnées bbox (la `latitude` correspond aux **2e** et **4e** nombres, et la `longitude` aux **1er** et **3e**). Dans l’exemple de Toronto ci-dessus, nous pourrions utiliser 44.0 et -79.0.
:::

Les deux dernières informations nécessaires sont `creator` et `version`. Elles ne sont pas présentes dans le pack mais sont obligatoires. Vous pouvez utiliser le nom du `creator` indiqué sur la [page de téléchargement](https://github.com/kaicardenas0618/Subway-Builder-Map-Directory/wiki/Map-Directory). Vous pouvez choisir n’importe quelle valeur pour `version`. Une fois toutes les informations réunies, assurez-vous d’avoir les 6 fichiers requis. Vous êtes alors prêt pour l’étape suivante.

:::important
Bien que ce ne soit pas obligatoire, si vous comptez partager cette carte portée, veuillez inclure le `creator` afin que les créateurs originaux reçoivent le crédit pour leur travail.
:::

### Étape 4 - Compresser les Fichiers
Maintenant que nous avons les 6 fichiers, nous devons les regrouper dans une archive `.zip`. Cela peut être fait nativement sous Windows ou Linux, ou avec [7-Zip](https://www.7-zip.org/download.html), ou encore sous macOS en sélectionnant `Compresser`. Une fois le fichier `.zip` créé, le portage est terminé ; il ne reste plus qu’à l’importer dans le jeu.

### Étape 5 - Ajouter la Carte

Pour installer une carte, cliquez sur le bouton `ADD A MAP` et importez le fichier ZIP contenant votre carte. Une fois l’opération terminée, le nom de la carte, le créateur et la version devraient apparaître à l’écran.

<img width="1200" alt="image" src="https://private-user-images.githubusercontent.com/19807509/553076477-c08ebbab-5ce3-41d5-b713-b8050d2a51bf.png?jwt=..." />

### Étape 6 - Lancer Subway Builder

Une fois toutes vos cartes ajoutées, vous pouvez lancer le jeu en cliquant sur `START GAME`. À partir de maintenant, c’est ainsi que vous devrez lancer le jeu. Dans le jeu, vos cartes apparaîtront dans l’onglet `CUSTOM` et seront prêtes à être jouées.

:::important
En raison du fonctionnement actuel du jeu, vous devez lancer le jeu via le Map Manager chaque fois que vous souhaitez jouer à une carte personnalisée. Si vous ne lancez pas le jeu via le Map Manager, les bâtiments et l’eau n’apparaîtront pas en jeu.
:::

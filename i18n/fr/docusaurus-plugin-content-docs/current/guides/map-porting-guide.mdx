---
id: map-porting-guide
title: Guide de Portage de Carte
---

Ce guide s'adresse à toutes les cartes créées avant la version 1.0.0 et la sortie de l'API de modding, comme le [Pack Australie/Nouvelle-Zélande par expedtadam](https://drive.google.com/drive/folders/18fpT9ASi3kMIK0lYjOzAbb-IM_RPZ6cz). Il nécessite un peu plus de configuration, mais peut être porté vers le nouveau framework relativement facilement.

### Étape 1 - Installer le Gestionnaire de Cartes
Téléchargez la dernière version du Gestionnaire de Cartes sur https://github.com/Kronifer/subwaybuilder-patcher/releases. Pour télécharger, cliquez sur la version correspondant à votre système d'exploitation.

<img width="1000" alt="image" src="https://github.com/user-attachments/assets/4bc7b27d-9868-475f-9a4a-5ce447a77036" />

:::note
Pour Windows, prenez le fichier `.exe`. Pour Linux, le fichier `.zip`. Pour MacOS, utilisez `arm64.dmg` si votre Mac a une puce Apple Silicon (ex. M1, M2, M3, etc.) et `x64.dmg` si votre Mac a une puce Intel. En règle générale, les Macs postérieurs à 2021 ont des puces Apple Silicon et les modèles plus anciens ont des puces Intel, mais vérifiez toujours.
:::

:::note
Sur MacOS, le programme d'installation .dmg est probablement en quarantaine. Pour l'exécuter, ouvrez un terminal dans le dossier où se trouve l'installateur et exécutez `xattr -d com.apple.quarantine {INSTALLER_FILENAME}`. Par exemple, pour télécharger la version 0.2.7 pour un Mac ARM, exécutez `xattr -d com.apple.quarantine Subway.Builder.Map.Manager-0.2.7-arm64.dmg`.
:::

Ensuite, installez l'application comme n'importe quelle autre application. Une fois l'installation terminée, lancez l'application et suivez le processus de configuration. À ce stade, vous pouvez supprimer le ZIP, l'installateur et tous les autres fichiers téléchargés.

### Étape 2 - Extraire les Fichiers
Maintenant, nous devons extraire les fichiers nécessaires de la carte téléchargée. Nous avons besoin de 6 fichiers au total :
 - `XXX.pmtiles` (`XXX` est le code de votre ville ; ex. `MIA` pour Miami)
 - `demand_data.json`
 - `buildings_index.json`
 - `roads.geojson`
 - `runways_taxiways.geojson`
 - `config.json`

Le premier est facile. Cherchez le fichier `XXX.pmtiles` dans le dossier de la carte. Il se trouve soit à la racine, soit dans un sous-dossier. Pour l'instant, créez un dossier temporaire pour stocker les 6 fichiers.

Les 4 suivants nécessitent un peu plus de travail. Ils sont généralement compressés (`.gz`). Nous devons les extraire.

:::important
Si vos 4 fichiers sont `.gz` (ex. `demand_data.json.gz`), continuez à lire et suivez les étapes. Si ce ne sont pas des fichiers `.gz` (ex. `demand_data.json`), déplacez-les dans le dossier temporaire et passez à l'Étape 3. Si les 4 fichiers sont absents, la carte téléchargée est incomplète. Vous pouvez soit [générer les données vous-même](https://github.com/kaicardenas0618/Subway-Builder-Map-Directory/wiki/Creating-a-Custom-Map), soit trouver une autre carte.
:::

:::tip
Sur Windows et Linux, utilisez [7-Zip](https://www.7-zip.org/download.html) pour extraire `.gz`. MacOS prend en charge nativement les archives gzip ; il suffit de double-cliquer pour extraire.
:::

Vous verrez un seul fichier à l'intérieur. Par exemple, dans `demand_data.json.gz`, vous trouverez `demand_data.json`. Faites de même pour les 3 autres archives et placez-les dans le dossier temporaire. Certains packs ont des fichiers en double ; peu importe lequel vous choisissez.

### Étape 3 - Créer le Config
Le dernier fichier nécessaire est `config.json`. C'est le plus compliqué. Commencez par créer un nouveau fichier nommé `config.json`.

:::tip
Assurez-vous qu'il s'agit d'un fichier `.json`. Recherchez comment activer l'affichage des extensions sur votre système si nécessaire.
:::

Dans `config.json`, collez ce modèle :
```
{
    "name": "Boise",
    "code": "BOI",
    "description": "Build a rapid transit network for one of America`s fastest growing cities.",
    "population": 329866,
    "initialViewState": {
        "zoom": 13,
        "latitude": 43.617499,
        "longitude": -116.245394,
        "bearing": 0
    },
    "creator": "muffintime",
    "version": "2.1.0"
}
```

Nous devons modifier ces données pour correspondre à notre carte. Cherchez un fichier `.js` dans le répertoire (souvent `index.js`, `main.js` ou `config.js`).

<img width="1097" height="402" alt="image" src="https://github.com/user-attachments/assets/b25a1577-badf-4adf-a414-d76003c3a26d" />

> Ceci se trouve dans `index.js` du Pack de Villes Canadiennes.

:::tip
Si plusieurs `.js` existent, vérifiez-les tous ; l'un contient les données nécessaires.
:::

De ce fichier, nous pouvons récupérer :
 - `name`
 - `code`
 - `description`
 - `population`
 - `initialViewState` (et tous ses paramètres)

:::note
Si vos données n’incluent pas `initialViewState`, mettez 12 ou 13 pour `zoom` et 0 pour `bearing`. Pour `latitude` et `longitude`, choisissez n'importe quelle valeur dans votre bbox. Dans l'exemple de Toronto, nous pourrions utiliser 44.0 et -79.0.
:::

Les deux derniers éléments nécessaires sont `creator` et `version`. Ces données ne sont pas fournies dans le pack, mais sont obligatoires. Utilisez le `creator` indiqué sur la [page de téléchargement](https://github.com/kaicardenas0618/Subway-Builder-Map-Directory/wiki/Map-Directory). Mettez n'importe quelle valeur pour `version`. Une fois les 6 fichiers prêts, continuez.

:::important
Bien que non obligatoire, si vous prévoyez de partager la carte portée, incluez le `creator` pour créditer les créateurs originaux.
:::

### Étape 4 - Compresser les Fichiers
Maintenant que nous avons les 6 fichiers, empaquetez-les en `.zip`. Cela peut se faire nativement sur Windows, Linux ou MacOS (Compress) ou avec [7-Zip](https://www.7-zip.org/download.html). Une fois le `.zip` créé, le portage est presque terminé et il ne reste plus qu’à l’importer dans le jeu.

### Étape 5 - Ajouter la Carte
Pour installer une carte, cliquez sur `ADD A MAP` et importez le fichier ZIP. Le nom de la carte, le créateur et la version s’afficheront.

<img width="1200" alt="image" src="https://github.com/user-attachments/assets/c258cf39-c211-4677-8ac1-0828a97d5c61" />

Une fois toutes les cartes importées, cliquez sur `GENERATE MOD`. Cela ajoute automatiquement les cartes à Subway Builder et enregistre le Map Manager comme mod.

Si vous voulez ajouter une autre carte après, relancez le Map Manager et importez toutes les cartes désirées (y compris celles déjà présentes). Cliquez sur `GENERATE MOD` et elles seront ajoutées automatiquement. Si vous ne ré-ajoutez pas les anciennes cartes, elles seront supprimées.

### Étape 6 - Lancer Subway Builder
Une fois toutes les cartes ajoutées et le mod généré, lancez le jeu avec `START GAME`. Désormais, utilisez toujours cette méthode. Dans le jeu, les cartes apparaissent sous l'onglet `CUSTOM` et sont prêtes à jouer.

:::important
En raison du fonctionnement actuel du jeu, vous devez le lancer via Map Manager pour que les bâtiments et l’eau apparaissent.
:::

---
id: map-porting-guide
title: Guida al Porting delle Mappe
---

Questa guida è destinata a tutte le mappe create prima della versione 1.0.0 e del rilascio dell’API di modding, come il [Australia/New Zealand Pack by expedtadam](https://drive.google.com/drive/folders/18fpT9ASi3kMIK0lYjOzAbb-IM_RPZ6cz). Richiede un po' più di configurazione, ma può comunque essere portata sul nuovo framework relativamente facilmente.

### Passo 1 - Installare il Map Manager
Scarica l’ultima versione del Map Manager da https://github.com/Kronifer/subwaybuilder-patcher/releases. Per scaricare, clicca sulla versione corrispondente al tuo sistema operativo.

<img width="1000" alt="image" src="/images/map-manager-download.png" />

:::note
Su Windows, serve il file `.exe`. Su Linux, serve il file `.zip`. Su macOS, usa il file `arm64.dmg` se il tuo Mac ha un chip Apple Silicon (ad esempio M1, M2, M3, ecc.) e il file `x64.dmg` se il tuo Mac ha un chip Intel. In generale, i Mac successivi al 2021 hanno Apple Silicon, mentre i modelli più vecchi hanno Intel, ma verifica sempre, ci sono eccezioni.
:::

:::note
Su macOS, l’installer `.dmg` potrebbe essere messo in quarantena. Per eseguirlo, apri un terminale nella cartella dove lo hai scaricato e digita `xattr -d com.apple.quarantine {NOME_FILE_INSTALLER}`. Ad esempio, per la versione 0.2.7 su Mac ARM, esegui `xattr -d com.apple.quarantine Subway.Builder.Map.Manager-0.2.7-arm64.dmg`.

Inoltre, la cartella Library contenente `metro-maker4` potrebbe essere nascosta. Per mostrarla, apri Finder, vai nella cartella Home e seleziona Vista → Mostra opzioni vista → Mostra cartella Libreria.
:::

Dopo, installa l’app normalmente. Una volta terminata l’installazione, apri l’app e segui la procedura guidata selezionando la posizione dell’eseguibile del gioco e la cartella `metro-maker4`. A questo punto puoi eliminare in sicurezza lo ZIP, l’installer e altri file scaricati.

<img width="1200" alt="image" src="https://private-user-images.githubusercontent.com/19807509/553076498-ea9604c2-bc93-4cb4-939c-73d957b22f2a.png?jwt=..." />

### Passo 2 - Estrarre i File
Ora dobbiamo estrarre i file necessari dalla mappa scaricata. In totale servono 6 file:
 - `XXX.pmtiles` (`XXX` è il codice della tua città; es. `MIA` per Miami)
 - `demand_data.json`
 - `buildings_index.json`
 - `roads.geojson`
 - `runways_taxiways.geojson`
 - `config.json`

Il primo è semplice. Nella cartella della mappa, cerca il file `XXX.pmtiles`. Si trova da qualche parte nel directory, alla radice o in una sottocartella. Crea una cartella temporanea dove mettere i 6 file.

Gli altri 4 richiedono un po’ più di lavoro. Dovresti trovarli facilmente, ma sono compressi (terminano con `.gz`). Dovremo estrarli come archivio.

:::important
Se i 4 file sono `.gz` (es. `demand_data.json.gz`), continua a leggere e segui il resto di questo passo. Se i file non sono `.gz` (es. `demand_data.json`), salta il resto di questo passo, sposta i file nella cartella temporanea e passa al Passo 3. Se i 4 file non ci sono, la mappa scaricata è incompleta. Puoi [generare i dati tu stesso](https://github.com/kaicardenas0618/Subway-Builder-Map-Directory/wiki/Creating-a-Custom-Map) o trovare un’altra mappa.
:::

:::tip
Su Windows e Linux, puoi usare [7-Zip](https://www.7-zip.org/download.html) per estrarre gli archivi `.gz`. macOS supporta nativamente gzip, quindi basta cliccare due volte per estrarre.
:::

All’interno dovresti vedere un solo file. Ad esempio in `demand_data.json.gz` troverai `demand_data.json`. Lo stesso vale per gli altri 3 archivi. Estrai tutti e 4 i file e mettili nella cartella temporanea. Alcune mappe hanno duplicati dei file dati, non importa quale scegli, sono identici.

### Passo 3 - Creare il Config
L’ultimo file necessario è `config.json`. Questo è il più complesso. Crea un nuovo file chiamato `config.json`.

:::tip
Assicurati sia un file `.json`. Se l’estensione non appare, cerca come abilitare le estensioni dei file sul tuo sistema.
:::

Incolla questo template in `config.json`:
```
{
  "name": "Boise",
  "code": "BOI",
  "description": "Build a rapid transit network for one of America`s fastest growing cities.",
  "population": 329866,
  "initialViewState": {
    "zoom": 13,
    "latitude": 43.617499,
    "longitude": -116.245394,
    "bearing": 0
  },
  "creator": "muffintime",
  "version": "2.1.0"
}
```

Dobbiamo modificare questi dati per adattarli alla mappa. Nella directory della mappa dovrebbe esserci un file `.js`, spesso chiamato `index.js`, `main.js` o `config.js`.

<img width="1097" height="402" alt="image" src="/images/city-data.png" />

> Esempio dal file `index.js` del Canadian Cities Map Pack.

:::tip
Se ci sono più file `.js`, controllali tutti. Uno di essi contiene i dati necessari.
:::

Da questo file possiamo ottenere:
 - `name`
 - `code`
 - `description`
 - `population`
 - `initialViewState` (e tutti i suoi parametri)

:::note
Se i dati non contengono `initialViewState`, puoi usare 12 o 13 per `zoom` e 0 per `bearing`. Per `latitude` e `longitude`, scegli un numero all’interno del range bbox (latitude corrisponde al **2°** e **4°** numero, longitude al **1°** e **3°**). Nell’esempio di Toronto sopra possiamo usare 44.0 e -79.0.
:::

Le ultime 2 informazioni necessarie sono `creator` e `version`. Questi dati non sono presenti nel pacchetto ma sono richiesti. Puoi usare il `creator` indicato sulla [pagina download](https://github.com/kaicardenas0618/Subway-Builder-Map-Directory/wiki/Map-Directory). Puoi inserire qualsiasi valore per `version`. Una volta ottenute tutte le informazioni, assicurati di avere tutti e 6 i file. Sei pronto per il passo successivo.

:::important
Non obbligatorio, ma se condividi la mappa portata, includi il `creator` per dare credito agli autori originali.
:::

### Passo 4 - Comprimere i File
Ora che abbiamo tutti e 6 i file, dobbiamo inserirli in un archivio `.zip`. Questo può essere fatto nativamente su Windows o Linux, con [7-Zip](https://www.7-zip.org/download.html), o su macOS scegliendo `Comprimi`. Una volta creato il `.zip`, il porting è completato e resta solo importarlo nel gioco.

### Passo 5 - Aggiungere la Mappa

Per installare una mappa, clicca su `ADD A MAP` e importa il file ZIP contenente la mappa. Una volta fatto, il nome della mappa, il creator e la versione appariranno sullo schermo.

<img width="1200" alt="image" src="https://private-user-images.githubusercontent.com/19807509/553076477-c08ebbab-5ce3-41d5-b713-b8050d2a51bf.png?jwt=..." />

### Passo 6 - Avviare Subway Builder

Una volta aggiunte tutte le mappe, puoi avviare il gioco con `START GAME`. D’ora in poi, questo sarà il metodo per lanciare il gioco. In gioco, le mappe appariranno nella scheda `CUSTOM` e saranno pronte per essere giocate.

:::important
A causa del funzionamento attuale del gioco, devi avviare il gioco tramite il Map Manager ogni volta che vuoi giocare a una mappa personalizzata. Se non lo fai, edifici e acqua non appariranno nel gioco.
:::
